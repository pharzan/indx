!function(){"use strict";var t=0,e={};function n(){function r(){return arguments.length>0&&arguments[0]!==e&&a(r,arguments[0]),r._state.value}var s;return(s=r).constructor=n,s._state={id:t++,value:void 0,state:0,derive:void 0,recover:void 0,deps:{},parents:[],endStream:void 0,unregister:void 0},s.map=s["fantasy-land/map"]=o,s["fantasy-land/ap"]=f,s["fantasy-land/of"]=n,s.valueOf=c,s.toJSON=d,s.toString=c,Object.defineProperties(s,{end:{get:function(){if(!s._state.endStream){var t=n();t.map(function(e){return!0===e&&(u(s),t._state.unregister=function(){u(t)}),e}),s._state.endStream=t}return s._state.endStream}}}),arguments.length>0&&arguments[0]!==e&&a(r,arguments[0]),r}function a(t,e){for(var n in r(t,e),t._state.deps)s(t._state.deps[n],!1);null!=t._state.unregister&&t._state.unregister(),function(t){for(var e in t._state.changed=!1,t._state.deps)t._state.deps[e]._state.changed=!1}(t)}function r(t,e){t._state.value=e,t._state.changed=!0,2!==t._state.state&&(t._state.state=1)}function s(t,n){var a=t._state.parents;if(a.length>0&&a.every(v)&&(n||a.some(p))){var s=t._state.derive();if(s===e)return!1;r(t,s)}}function i(t,e){if(!e.every(_))throw new Error("Ensure that each item passed to stream.combine/stream.merge is a stream");return a=n(),r=e,i=function(){return t.apply(this,e.concat([e.filter(p)]))},(u=a._state).derive=i,u.parents=r.filter(l),function t(e,n){for(var a=0;a<n.length;a++)n[a]._state.deps[e._state.id]=e,t(e,n[a]._state.parents)}(a,u.parents),s(a,!0),a;var a,r,i,u}function u(t){for(var e=0;e<t._state.parents.length;e++){delete t._state.parents[e]._state.deps[t._state.id]}for(var n in t._state.deps){var a=t._state.deps[n],r=a._state.parents.indexOf(t);r>-1&&a._state.parents.splice(r,1)}t._state.state=2,t._state.deps={}}function o(t){return i(function(e){return t(e())},[this])}function f(t){return i(function(t,e){return t()(e())},[t,this])}function c(){return this._state.value}function d(){return null!=this._state.value&&"function"==typeof this._state.value.toJSON?this._state.value.toJSON():this._state.value}function _(t){return t._state}function v(t){return 1===t._state.state}function p(t){return t._state.changed}function l(t){return 2!==t._state.state}n["fantasy-land/of"]=n,n.merge=function(t){return i(function(){return t.map(function(t){return t()})},t)},n.combine=i,n.scan=function(t,e,n){var a=i(function(n){return e=t(e,n._state.value)},[n]);return 0===a._state.state&&a(e),a},n.scanMerge=function(t,e){var n=t.map(function(t){var e=t[0];return 0===e._state.state&&e(void 0),e});return i(function(){var a=arguments[arguments.length-1];return n.forEach(function(n,r){a.indexOf(n)>-1&&(e=t[r][1](e,n._state.value))}),e},n)},n.HALT=e,"undefined"!=typeof module?module.exports=n:"function"!=typeof window.m||"stream"in window.m?window.m={stream:n}:window.m.stream=n}();